{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"D:/Projects/verifiedprofilev2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"D:/Projects/verifiedprofilev2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchJson = void 0;\n\nvar http_errors_1 = __importDefault(require(\"http-errors\"));\n\nvar exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\n\nvar providers_1 = require(\"../providers\");\n\nvar errors_1 = require(\"./errors\");\n\nvar START_WAIT_TIME_MS = 1000;\nvar BACKOFF_MULTIPLIER = 1.5;\nvar RETRY_NUMBER = 10;\n\nfunction fetchJson(_x, _x2) {\n  return _fetchJson.apply(this, arguments);\n}\n\nfunction _fetchJson() {\n  _fetchJson = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(connection, json) {\n    var url, response;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            url = null;\n\n            if (typeof connection === 'string') {\n              url = connection;\n            } else {\n              url = connection.url;\n            }\n\n            _context2.next = 4;\n            return exponential_backoff_1.default(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n              var _response;\n\n              return _regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _context.next = 3;\n                      return fetch(url, {\n                        method: json ? 'POST' : 'GET',\n                        body: json ? json : undefined,\n                        headers: {\n                          'Content-Type': 'application/json; charset=utf-8'\n                        }\n                      });\n\n                    case 3:\n                      _response = _context.sent;\n\n                      if (_response.ok) {\n                        _context.next = 14;\n                        break;\n                      }\n\n                      if (!(_response.status === 503)) {\n                        _context.next = 8;\n                        break;\n                      }\n\n                      errors_1.logWarning(\"Retrying HTTP request for \".concat(url, \" as it's not available now\"));\n                      return _context.abrupt(\"return\", null);\n\n                    case 8:\n                      _context.t0 = http_errors_1;\n                      _context.t1 = _response.status;\n                      _context.next = 12;\n                      return _response.text();\n\n                    case 12:\n                      _context.t2 = _context.sent;\n                      throw _context.t0.default.call(_context.t0, _context.t1, _context.t2);\n\n                    case 14:\n                      return _context.abrupt(\"return\", _response);\n\n                    case 17:\n                      _context.prev = 17;\n                      _context.t3 = _context[\"catch\"](0);\n\n                      if (!(_context.t3.toString().includes('FetchError') || _context.t3.toString().includes('Failed to fetch'))) {\n                        _context.next = 22;\n                        break;\n                      }\n\n                      errors_1.logWarning(\"Retrying HTTP request for \".concat(url, \" because of error: \").concat(_context.t3));\n                      return _context.abrupt(\"return\", null);\n\n                    case 22:\n                      throw _context.t3;\n\n                    case 23:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee, null, [[0, 17]]);\n            })));\n\n          case 4:\n            response = _context2.sent;\n\n            if (response) {\n              _context2.next = 7;\n              break;\n            }\n\n            throw new providers_1.TypedError(\"Exceeded \".concat(RETRY_NUMBER, \" attempts for \").concat(url, \".\"), 'RetriesExceeded');\n\n          case 7:\n            _context2.next = 9;\n            return response.json();\n\n          case 9:\n            return _context2.abrupt(\"return\", _context2.sent);\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _fetchJson.apply(this, arguments);\n}\n\nexports.fetchJson = fetchJson;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","fetchJson","http_errors_1","require","exponential_backoff_1","providers_1","errors_1","START_WAIT_TIME_MS","BACKOFF_MULTIPLIER","RETRY_NUMBER","connection","json","url","default","fetch","method","body","undefined","headers","response","ok","status","logWarning","text","toString","includes","TypedError"],"sources":["D:/Projects/verifiedprofilev2/node_modules/near-api-js/lib/utils/web.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fetchJson = void 0;\nconst http_errors_1 = __importDefault(require(\"http-errors\"));\nconst exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\nconst providers_1 = require(\"../providers\");\nconst errors_1 = require(\"./errors\");\nconst START_WAIT_TIME_MS = 1000;\nconst BACKOFF_MULTIPLIER = 1.5;\nconst RETRY_NUMBER = 10;\nasync function fetchJson(connection, json) {\n    let url = null;\n    if (typeof (connection) === 'string') {\n        url = connection;\n    }\n    else {\n        url = connection.url;\n    }\n    const response = await exponential_backoff_1.default(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, async () => {\n        try {\n            const response = await fetch(url, {\n                method: json ? 'POST' : 'GET',\n                body: json ? json : undefined,\n                headers: { 'Content-Type': 'application/json; charset=utf-8' }\n            });\n            if (!response.ok) {\n                if (response.status === 503) {\n                    errors_1.logWarning(`Retrying HTTP request for ${url} as it's not available now`);\n                    return null;\n                }\n                throw http_errors_1.default(response.status, await response.text());\n            }\n            return response;\n        }\n        catch (error) {\n            if (error.toString().includes('FetchError') || error.toString().includes('Failed to fetch')) {\n                errors_1.logWarning(`Retrying HTTP request for ${url} because of error: ${error}`);\n                return null;\n            }\n            throw error;\n        }\n    });\n    if (!response) {\n        throw new providers_1.TypedError(`Exceeded ${RETRY_NUMBER} attempts for ${url}.`, 'RetriesExceeded');\n    }\n    return await response.json();\n}\nexports.fetchJson = fetchJson;\n"],"mappings":"AAAA;;;;;;AACA,IAAIA,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;IAAE,WAAWA;EAAb,CAAvC;AACH,CAFD;;AAGAE,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,SAAR,GAAoB,KAAK,CAAzB;;AACA,IAAMC,aAAa,GAAGR,eAAe,CAACS,OAAO,CAAC,aAAD,CAAR,CAArC;;AACA,IAAMC,qBAAqB,GAAGV,eAAe,CAACS,OAAO,CAAC,uBAAD,CAAR,CAA7C;;AACA,IAAME,WAAW,GAAGF,OAAO,CAAC,cAAD,CAA3B;;AACA,IAAMG,QAAQ,GAAGH,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAMI,kBAAkB,GAAG,IAA3B;AACA,IAAMC,kBAAkB,GAAG,GAA3B;AACA,IAAMC,YAAY,GAAG,EAArB;;SACeR,S;;;;;wEAAf,kBAAyBS,UAAzB,EAAqCC,IAArC;IAAA;IAAA;MAAA;QAAA;UAAA;YACQC,GADR,GACc,IADd;;YAEI,IAAI,OAAQF,UAAR,KAAwB,QAA5B,EAAsC;cAClCE,GAAG,GAAGF,UAAN;YACH,CAFD,MAGK;cACDE,GAAG,GAAGF,UAAU,CAACE,GAAjB;YACH;;YAPL;YAAA,OAQ2BR,qBAAqB,CAACS,OAAtB,CAA8BN,kBAA9B,EAAkDE,YAAlD,EAAgED,kBAAhE,wEAAoF;cAAA;;cAAA;gBAAA;kBAAA;oBAAA;sBAAA;sBAAA;sBAAA,OAE5EM,KAAK,CAACF,GAAD,EAAM;wBAC9BG,MAAM,EAAEJ,IAAI,GAAG,MAAH,GAAY,KADM;wBAE9BK,IAAI,EAAEL,IAAI,GAAGA,IAAH,GAAUM,SAFU;wBAG9BC,OAAO,EAAE;0BAAE,gBAAgB;wBAAlB;sBAHqB,CAAN,CAFuE;;oBAAA;sBAE7FC,SAF6F;;sBAAA,IAO9FA,SAAQ,CAACC,EAPqF;wBAAA;wBAAA;sBAAA;;sBAAA,MAQ3FD,SAAQ,CAACE,MAAT,KAAoB,GARuE;wBAAA;wBAAA;sBAAA;;sBAS3Ff,QAAQ,CAACgB,UAAT,qCAAiDV,GAAjD;sBAT2F,iCAUpF,IAVoF;;oBAAA;sBAAA,cAYzFV,aAZyF;sBAAA,cAYnEiB,SAAQ,CAACE,MAZ0D;sBAAA;sBAAA,OAY5CF,SAAQ,CAACI,IAAT,EAZ4C;;oBAAA;sBAAA;sBAAA,kBAY3EV,OAZ2E;;oBAAA;sBAAA,iCAc5FM,SAd4F;;oBAAA;sBAAA;sBAAA;;sBAAA,MAiB/F,YAAMK,QAAN,GAAiBC,QAAjB,CAA0B,YAA1B,KAA2C,YAAMD,QAAN,GAAiBC,QAAjB,CAA0B,iBAA1B,CAjBoD;wBAAA;wBAAA;sBAAA;;sBAkB/FnB,QAAQ,CAACgB,UAAT,qCAAiDV,GAAjD;sBAlB+F,iCAmBxF,IAnBwF;;oBAAA;sBAAA;;oBAAA;oBAAA;sBAAA;kBAAA;gBAAA;cAAA;YAAA,CAApF,GAR3B;;UAAA;YAQUO,QARV;;YAAA,IAgCSA,QAhCT;cAAA;cAAA;YAAA;;YAAA,MAiCc,IAAId,WAAW,CAACqB,UAAhB,oBAAuCjB,YAAvC,2BAAoEG,GAApE,QAA4E,iBAA5E,CAjCd;;UAAA;YAAA;YAAA,OAmCiBO,QAAQ,CAACR,IAAT,EAnCjB;;UAAA;YAAA;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,C;;;;AAqCAZ,OAAO,CAACE,SAAR,GAAoBA,SAApB"},"metadata":{},"sourceType":"script"}