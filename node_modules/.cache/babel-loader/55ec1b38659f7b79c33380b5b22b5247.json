{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fetchJson = void 0;\n\nconst http_errors_1 = __importDefault(require(\"http-errors\"));\n\nconst exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\n\nconst providers_1 = require(\"../providers\");\n\nconst errors_1 = require(\"./errors\");\n\nconst START_WAIT_TIME_MS = 1000;\nconst BACKOFF_MULTIPLIER = 1.5;\nconst RETRY_NUMBER = 10;\n\nasync function fetchJson(connection, json) {\n  let url = null;\n\n  if (typeof connection === 'string') {\n    url = connection;\n  } else {\n    url = connection.url;\n  }\n\n  const response = await exponential_backoff_1.default(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, async () => {\n    try {\n      const response = await fetch(url, {\n        method: json ? 'POST' : 'GET',\n        body: json ? json : undefined,\n        headers: {\n          'Content-Type': 'application/json; charset=utf-8'\n        }\n      });\n\n      if (!response.ok) {\n        if (response.status === 503) {\n          errors_1.logWarning(`Retrying HTTP request for ${url} as it's not available now`);\n          return null;\n        }\n\n        throw http_errors_1.default(response.status, await response.text());\n      }\n\n      return response;\n    } catch (error) {\n      if (error.toString().includes('FetchError') || error.toString().includes('Failed to fetch')) {\n        errors_1.logWarning(`Retrying HTTP request for ${url} because of error: ${error}`);\n        return null;\n      }\n\n      throw error;\n    }\n  });\n\n  if (!response) {\n    throw new providers_1.TypedError(`Exceeded ${RETRY_NUMBER} attempts for ${url}.`, 'RetriesExceeded');\n  }\n\n  return await response.json();\n}\n\nexports.fetchJson = fetchJson;","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","fetchJson","http_errors_1","require","exponential_backoff_1","providers_1","errors_1","START_WAIT_TIME_MS","BACKOFF_MULTIPLIER","RETRY_NUMBER","connection","json","url","response","default","fetch","method","body","undefined","headers","ok","status","logWarning","text","error","toString","includes","TypedError"],"sources":["D:/Projects/verifiedprofilev3/node_modules/near-api-js/lib/utils/web.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fetchJson = void 0;\nconst http_errors_1 = __importDefault(require(\"http-errors\"));\nconst exponential_backoff_1 = __importDefault(require(\"./exponential-backoff\"));\nconst providers_1 = require(\"../providers\");\nconst errors_1 = require(\"./errors\");\nconst START_WAIT_TIME_MS = 1000;\nconst BACKOFF_MULTIPLIER = 1.5;\nconst RETRY_NUMBER = 10;\nasync function fetchJson(connection, json) {\n    let url = null;\n    if (typeof (connection) === 'string') {\n        url = connection;\n    }\n    else {\n        url = connection.url;\n    }\n    const response = await exponential_backoff_1.default(START_WAIT_TIME_MS, RETRY_NUMBER, BACKOFF_MULTIPLIER, async () => {\n        try {\n            const response = await fetch(url, {\n                method: json ? 'POST' : 'GET',\n                body: json ? json : undefined,\n                headers: { 'Content-Type': 'application/json; charset=utf-8' }\n            });\n            if (!response.ok) {\n                if (response.status === 503) {\n                    errors_1.logWarning(`Retrying HTTP request for ${url} as it's not available now`);\n                    return null;\n                }\n                throw http_errors_1.default(response.status, await response.text());\n            }\n            return response;\n        }\n        catch (error) {\n            if (error.toString().includes('FetchError') || error.toString().includes('Failed to fetch')) {\n                errors_1.logWarning(`Retrying HTTP request for ${url} because of error: ${error}`);\n                return null;\n            }\n            throw error;\n        }\n    });\n    if (!response) {\n        throw new providers_1.TypedError(`Exceeded ${RETRY_NUMBER} attempts for ${url}.`, 'RetriesExceeded');\n    }\n    return await response.json();\n}\nexports.fetchJson = fetchJson;\n"],"mappings":"AAAA;;AACA,IAAIA,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;EACnE,OAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;IAAE,WAAWA;EAAb,CAAvC;AACH,CAFD;;AAGAE,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,SAAR,GAAoB,KAAK,CAAzB;;AACA,MAAMC,aAAa,GAAGR,eAAe,CAACS,OAAO,CAAC,aAAD,CAAR,CAArC;;AACA,MAAMC,qBAAqB,GAAGV,eAAe,CAACS,OAAO,CAAC,uBAAD,CAAR,CAA7C;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAC,cAAD,CAA3B;;AACA,MAAMG,QAAQ,GAAGH,OAAO,CAAC,UAAD,CAAxB;;AACA,MAAMI,kBAAkB,GAAG,IAA3B;AACA,MAAMC,kBAAkB,GAAG,GAA3B;AACA,MAAMC,YAAY,GAAG,EAArB;;AACA,eAAeR,SAAf,CAAyBS,UAAzB,EAAqCC,IAArC,EAA2C;EACvC,IAAIC,GAAG,GAAG,IAAV;;EACA,IAAI,OAAQF,UAAR,KAAwB,QAA5B,EAAsC;IAClCE,GAAG,GAAGF,UAAN;EACH,CAFD,MAGK;IACDE,GAAG,GAAGF,UAAU,CAACE,GAAjB;EACH;;EACD,MAAMC,QAAQ,GAAG,MAAMT,qBAAqB,CAACU,OAAtB,CAA8BP,kBAA9B,EAAkDE,YAAlD,EAAgED,kBAAhE,EAAoF,YAAY;IACnH,IAAI;MACA,MAAMK,QAAQ,GAAG,MAAME,KAAK,CAACH,GAAD,EAAM;QAC9BI,MAAM,EAAEL,IAAI,GAAG,MAAH,GAAY,KADM;QAE9BM,IAAI,EAAEN,IAAI,GAAGA,IAAH,GAAUO,SAFU;QAG9BC,OAAO,EAAE;UAAE,gBAAgB;QAAlB;MAHqB,CAAN,CAA5B;;MAKA,IAAI,CAACN,QAAQ,CAACO,EAAd,EAAkB;QACd,IAAIP,QAAQ,CAACQ,MAAT,KAAoB,GAAxB,EAA6B;UACzBf,QAAQ,CAACgB,UAAT,CAAqB,6BAA4BV,GAAI,4BAArD;UACA,OAAO,IAAP;QACH;;QACD,MAAMV,aAAa,CAACY,OAAd,CAAsBD,QAAQ,CAACQ,MAA/B,EAAuC,MAAMR,QAAQ,CAACU,IAAT,EAA7C,CAAN;MACH;;MACD,OAAOV,QAAP;IACH,CAdD,CAeA,OAAOW,KAAP,EAAc;MACV,IAAIA,KAAK,CAACC,QAAN,GAAiBC,QAAjB,CAA0B,YAA1B,KAA2CF,KAAK,CAACC,QAAN,GAAiBC,QAAjB,CAA0B,iBAA1B,CAA/C,EAA6F;QACzFpB,QAAQ,CAACgB,UAAT,CAAqB,6BAA4BV,GAAI,sBAAqBY,KAAM,EAAhF;QACA,OAAO,IAAP;MACH;;MACD,MAAMA,KAAN;IACH;EACJ,CAvBsB,CAAvB;;EAwBA,IAAI,CAACX,QAAL,EAAe;IACX,MAAM,IAAIR,WAAW,CAACsB,UAAhB,CAA4B,YAAWlB,YAAa,iBAAgBG,GAAI,GAAxE,EAA4E,iBAA5E,CAAN;EACH;;EACD,OAAO,MAAMC,QAAQ,CAACF,IAAT,EAAb;AACH;;AACDZ,OAAO,CAACE,SAAR,GAAoBA,SAApB"},"metadata":{},"sourceType":"script"}